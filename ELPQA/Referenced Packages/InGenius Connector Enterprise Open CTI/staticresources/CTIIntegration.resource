<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- 2012 Copyright InGenius Software, Inc. -->
<html>
<head>
    <title>ICE Resiliency</title>
    <script type="text/javascript">
        // Source code in Plugins\ClientHandlers\Salesforce\SOURCE\SFDCSetupResources\CTIIntegration.ts
        /**/
!function(t){"use strict";if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var n="undefined"!=typeof window?window:self,e=n.Q;n.Q=t(),n.Q.noConflict=function(){return n.Q=e,this}}}(function(){"use strict";function t(t){return function(){return K.apply(t,arguments)}}function n(t){return t===Object(t)}function e(t){return"[object StopIteration]"===en(t)||t instanceof _}function r(t,n){if(V&&n.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(rn)){for(var e=[],r=n;r;r=r.source)r.stack&&e.unshift(r.stack);e.unshift(t.stack);var i=e.join("\n"+rn+"\n");t.stack=o(i)}}function o(t){for(var n=t.split("\n"),e=[],r=0;r<n.length;++r){var o=n[r];c(o)||i(o)||!o||e.push(o)}return e.join("\n")}function i(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function u(t){var n=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(n)return[n[1],Number(n[2])];var e=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(e)return[e[1],Number(e[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function c(t){var n=u(t);if(!n)return!1;var e=n[0],r=n[1];return e===H&&r>=q&&fn>=r}function s(){if(V)try{throw new Error}catch(t){var n=t.stack.split("\n"),e=n[0].indexOf("@")>0?n[1]:n[2],r=u(e);if(!r)return;return H=r[0],r[1]}}function f(t,n,e){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(n+" is deprecated, use "+e+" instead.",new Error("").stack),t.apply(t,arguments)}}function p(t){return t instanceof h?t:g(t)?O(t):E(t)}function a(){function t(t){n=t,i.source=t,W(e,function(n,e){p.nextTick(function(){t.promiseDispatch.apply(t,e)})},void 0),e=void 0,r=void 0}var n,e=[],r=[],o=Z(a.prototype),i=Z(h.prototype);if(i.promiseDispatch=function(t,o,i){var u=L(arguments);e?(e.push(u),"when"===o&&i[1]&&r.push(i[1])):p.nextTick(function(){n.promiseDispatch.apply(n,u)})},i.valueOf=function(){if(e)return i;var t=v(n);return m(t)&&(n=t),t},i.inspect=function(){return n?n.inspect():{state:"pending"}},p.longStackSupport&&V)try{throw new Error}catch(u){i.stack=u.stack.substring(u.stack.indexOf("\n")+1)}return o.promise=i,o.resolve=function(e){n||t(p(e))},o.fulfill=function(e){n||t(E(e))},o.reject=function(e){n||t(R(e))},o.notify=function(t){n||W(r,function(n,e){p.nextTick(function(){e(t)})},void 0)},o}function l(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var n=a();try{t(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}return n.promise}function d(t){return l(function(n,e){for(var r=0,o=t.length;o>r;r++)p(t[r]).then(n,e)})}function h(t,n,e){void 0===n&&(n=function(t){return R(new Error("Promise does not support operation: "+t))}),void 0===e&&(e=function(){return{state:"unknown"}});var r=Z(h.prototype);if(r.promiseDispatch=function(e,o,i){var u;try{u=t[o]?t[o].apply(r,i):n.call(r,o,i)}catch(c){u=R(c)}e&&e(u)},r.inspect=e,e){var o=e();"rejected"===o.state&&(r.exception=o.reason),r.valueOf=function(){var t=e();return"pending"===t.state||"rejected"===t.state?r:t.value}}return r}function y(t,n,e,r){return p(t).then(n,e,r)}function v(t){if(m(t)){var n=t.inspect();if("fulfilled"===n.state)return n.value}return t}function m(t){return t instanceof h}function g(t){return n(t)&&"function"==typeof t.then}function k(t){return m(t)&&"pending"===t.inspect().state}function j(t){return!m(t)||"fulfilled"===t.inspect().state}function w(t){return m(t)&&"rejected"===t.inspect().state}function b(){on.length=0,un.length=0,sn||(sn=!0)}function x(t,n){sn&&("object"==typeof process&&"function"==typeof process.emit&&p.nextTick.runAfter(function(){-1!==X(un,t)&&(process.emit("unhandledRejection",n,t),cn.push(t))}),un.push(t),on.push(n&&"undefined"!=typeof n.stack?n.stack:"(no stack) "+n))}function T(t){if(sn){var n=X(un,t);-1!==n&&("object"==typeof process&&"function"==typeof process.emit&&p.nextTick.runAfter(function(){var e=X(cn,t);-1!==e&&(process.emit("rejectionHandled",on[n],t),cn.splice(e,1))}),un.splice(n,1),on.splice(n,1))}}function R(t){var n=h({when:function(n){return n&&T(this),n?n(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return x(n,t),n}function E(t){return h({when:function(){return t},get:function(n){return t[n]},set:function(n,e){t[n]=e},"delete":function(n){delete t[n]},post:function(n,e){return null===n||void 0===n?t.apply(void 0,e):t[n].apply(t,e)},apply:function(n,e){return t.apply(n,e)},keys:function(){return nn(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function O(t){var n=a();return p.nextTick(function(){try{t.then(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}}),n.promise}function S(t){return h({isDef:function(){}},function(n,e){return A(t,n,e)},function(){return p(t).inspect()})}function N(t,n,e){return p(t).spread(n,e)}function D(t){return function(){function n(t,n){var u;if("undefined"==typeof StopIteration){try{u=r[t](n)}catch(c){return R(c)}return u.done?p(u.value):y(u.value,o,i)}try{u=r[t](n)}catch(c){return e(c)?p(c.value):R(c)}return y(u,o,i)}var r=t.apply(this,arguments),o=n.bind(n,"next"),i=n.bind(n,"throw");return o()}}function P(t){p.done(p.async(t)())}function C(t){throw new _(t)}function Q(t){return function(){return N([this,I(arguments)],function(n,e){return t.apply(n,e)})}}function A(t,n,e){return p(t).dispatch(n,e)}function I(t){return y(t,function(t){var n=0,e=a();return W(t,function(r,o,i){var u;m(o)&&"fulfilled"===(u=o.inspect()).state?t[i]=u.value:(++n,y(o,function(r){t[i]=r,0===--n&&e.resolve(t)},e.reject,function(t){e.notify({index:i,value:t})}))},void 0),0===n&&e.resolve(t),e.promise})}function U(t){if(0===t.length)return p.resolve();var n=p.defer(),e=0;return W(t,function(r,o,i){function u(t){n.resolve(t)}function c(){e--,0===e&&n.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function s(t){n.notify({index:i,value:t})}var f=t[i];e++,y(f,u,c,s)},void 0),n.promise}function F(t){return y(t,function(t){return t=Y(t,p),y(I(Y(t,function(t){return y(t,z,z)})),function(){return t})})}function M(t){return p(t).allSettled()}function B(t,n){return p(t).then(void 0,void 0,n)}function $(t,n){return p(t).nodeify(n)}var V=!1;try{throw new Error}catch(G){V=!!G.stack}var H,_,q=s(),z=function(){},J=function(){function t(){for(var t,r;e.next;)e=e.next,t=e.task,e.task=void 0,r=e.domain,r&&(e.domain=void 0,r.enter()),n(t,r);for(;c.length;)t=c.pop(),n(t);o=!1}function n(n,e){try{n()}catch(r){if(u)throw e&&e.exit(),setTimeout(t,0),e&&e.enter(),r;setTimeout(function(){throw r},0)}e&&e.exit()}var e={task:void 0,next:null},r=e,o=!1,i=void 0,u=!1,c=[];if(J=function(t){r=r.next={task:t,domain:u&&process.domain,next:null},o||(o=!0,i())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)u=!0,i=function(){process.nextTick(t)};else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=function(){i=f,s.port1.onmessage=t,t()};var f=function(){s.port2.postMessage(0)};i=function(){setTimeout(t,0),f()}}else i=function(){setTimeout(t,0)};return J.runAfter=function(t){c.push(t),o||(o=!0,i())},J}(),K=Function.call,L=t(Array.prototype.slice),W=t(Array.prototype.reduce||function(t,n){var e=0,r=this.length;if(1===arguments.length)for(;;){if(e in this){n=this[e++];break}if(++e>=r)throw new TypeError}for(;r>e;e++)e in this&&(n=t(n,this[e],e));return n}),X=t(Array.prototype.indexOf||function(t){for(var n=0;n<this.length;n++)if(this[n]===t)return n;return-1}),Y=t(Array.prototype.map||function(t,n){var e=this,r=[];return W(e,function(o,i,u){r.push(t.call(n,i,u,e))},void 0),r}),Z=Object.create||function(t){function n(){}return n.prototype=t,new n},tn=t(Object.prototype.hasOwnProperty),nn=Object.keys||function(t){var n=[];for(var e in t)tn(t,e)&&n.push(e);return n},en=t(Object.prototype.toString);_="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var rn="From previous event:";p.resolve=p,p.nextTick=J,p.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(p.longStackSupport=!0),p.defer=a,a.prototype.makeNodeResolver=function(){var t=this;return function(n,e){n?t.reject(n):t.resolve(arguments.length>2?L(arguments,1):e)}},p.Promise=l,p.promise=l,l.race=d,l.all=I,l.reject=R,l.resolve=p,p.passByCopy=function(t){return t},h.prototype.passByCopy=function(){return this},p.join=function(t,n){return p(t).join(n)},h.prototype.join=function(t){return p([this,t]).spread(function(t,n){if(t===n)return t;throw new Error("Can't join: not the same: "+t+" "+n)})},p.race=d,h.prototype.race=function(){return this.then(p.race)},p.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(t,n,e){function o(n){try{return"function"==typeof t?t(n):n}catch(e){return R(e)}}function i(t){if("function"==typeof n){r(t,c);try{return n(t)}catch(e){return R(e)}}return R(t)}function u(t){return"function"==typeof e?e(t):t}var c=this,s=a(),f=!1;return p.nextTick(function(){c.promiseDispatch(function(t){f||(f=!0,s.resolve(o(t)))},"when",[function(t){f||(f=!0,s.resolve(i(t)))}])}),c.promiseDispatch(void 0,"when",[void 0,function(t){var n,e=!1;try{n=u(t)}catch(r){if(e=!0,!p.onerror)throw r;p.onerror(r)}e||s.notify(n)}]),s.promise},p.tap=function(t,n){return p(t).tap(n)},h.prototype.tap=function(t){return t=p(t),this.then(function(n){return t.fcall(n).thenResolve(n)})},p.when=y,h.prototype.thenResolve=function(t){return this.then(function(){return t})},p.thenResolve=function(t,n){return p(t).thenResolve(n)},h.prototype.thenReject=function(t){return this.then(function(){throw t})},p.thenReject=function(t,n){return p(t).thenReject(n)},p.nearer=v,p.isPromise=m,p.isPromiseAlike=g,p.isPending=k,h.prototype.isPending=function(){return"pending"===this.inspect().state},p.isFulfilled=j,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},p.isRejected=w,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var on=[],un=[],cn=[],sn=!0;p.resetUnhandledRejections=b,p.getUnhandledReasons=function(){return on.slice()},p.stopUnhandledRejectionTracking=function(){b(),sn=!1},b(),p.reject=R,p.fulfill=E,p.master=S,p.spread=N,h.prototype.spread=function(t,n){return this.all().then(function(n){return t.apply(void 0,n)},n)},p.async=D,p.spawn=P,p["return"]=C,p.promised=Q,p.dispatch=A,h.prototype.dispatch=function(t,n){var e=this,r=a();return p.nextTick(function(){e.promiseDispatch(r.resolve,t,n)}),r.promise},p.get=function(t,n){return p(t).dispatch("get",[n])},h.prototype.get=function(t){return this.dispatch("get",[t])},p.set=function(t,n,e){return p(t).dispatch("set",[n,e])},h.prototype.set=function(t,n){return this.dispatch("set",[t,n])},p.del=p["delete"]=function(t,n){return p(t).dispatch("delete",[n])},h.prototype.del=h.prototype["delete"]=function(t){return this.dispatch("delete",[t])},p.mapply=p.post=function(t,n,e){return p(t).dispatch("post",[n,e])},h.prototype.mapply=h.prototype.post=function(t,n){return this.dispatch("post",[t,n])},p.send=p.mcall=p.invoke=function(t,n){return p(t).dispatch("post",[n,L(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(t){return this.dispatch("post",[t,L(arguments,1)])},p.fapply=function(t,n){return p(t).dispatch("apply",[void 0,n])},h.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},p["try"]=p.fcall=function(t){return p(t).dispatch("apply",[void 0,L(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,L(arguments)])},p.fbind=function(t){var n=p(t),e=L(arguments,1);return function(){return n.dispatch("apply",[this,e.concat(L(arguments))])}},h.prototype.fbind=function(){var t=this,n=L(arguments);return function(){return t.dispatch("apply",[this,n.concat(L(arguments))])}},p.keys=function(t){return p(t).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},p.all=I,h.prototype.all=function(){return I(this)},p.any=U,h.prototype.any=function(){return U(this)},p.allResolved=f(F,"allResolved","allSettled"),h.prototype.allResolved=function(){return F(this)},p.allSettled=M,h.prototype.allSettled=function(){return this.then(function(t){return I(Y(t,function(t){function n(){return t.inspect()}return t=p(t),t.then(n,n)}))})},p.fail=p["catch"]=function(t,n){return p(t).then(void 0,n)},h.prototype.fail=h.prototype["catch"]=function(t){return this.then(void 0,t)},p.progress=B,h.prototype.progress=function(t){return this.then(void 0,void 0,t)},p.fin=p["finally"]=function(t,n){return p(t)["finally"](n)},h.prototype.fin=h.prototype["finally"]=function(t){return t=p(t),this.then(function(n){return t.fcall().then(function(){return n})},function(n){return t.fcall().then(function(){throw n})})},p.done=function(t,n,e,r){return p(t).done(n,e,r)},h.prototype.done=function(t,n,e){var o=function(t){p.nextTick(function(){if(r(t,i),!p.onerror)throw t;p.onerror(t)})},i=t||n||e?this.then(t,n,e):this;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),i.then(void 0,o)},p.timeout=function(t,n,e){return p(t).timeout(n,e)},h.prototype.timeout=function(t,n){var e=a(),r=setTimeout(function(){n&&"string"!=typeof n||(n=new Error(n||"Timed out after "+t+" ms"),n.code="ETIMEDOUT"),e.reject(n)},t);return this.then(function(t){clearTimeout(r),e.resolve(t)},function(t){clearTimeout(r),e.reject(t)},e.notify),e.promise},p.delay=function(t,n){return void 0===n&&(n=t,t=void 0),p(t).delay(n)},h.prototype.delay=function(t){return this.then(function(n){var e=a();return setTimeout(function(){e.resolve(n)},t),e.promise})},p.nfapply=function(t,n){return p(t).nfapply(n)},h.prototype.nfapply=function(t){var n=a(),e=L(t);return e.push(n.makeNodeResolver()),this.fapply(e).fail(n.reject),n.promise},p.nfcall=function(t){var n=L(arguments,1);return p(t).nfapply(n)},h.prototype.nfcall=function(){var t=L(arguments),n=a();return t.push(n.makeNodeResolver()),this.fapply(t).fail(n.reject),n.promise},p.nfbind=p.denodeify=function(t){var n=L(arguments,1);return function(){var e=n.concat(L(arguments)),r=a();return e.push(r.makeNodeResolver()),p(t).fapply(e).fail(r.reject),r.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var t=L(arguments);return t.unshift(this),p.denodeify.apply(void 0,t)},p.nbind=function(t,n){var e=L(arguments,2);return function(){function r(){return t.apply(n,arguments)}var o=e.concat(L(arguments)),i=a();return o.push(i.makeNodeResolver()),p(r).fapply(o).fail(i.reject),i.promise}},h.prototype.nbind=function(){var t=L(arguments,0);return t.unshift(this),p.nbind.apply(void 0,t)},p.nmapply=p.npost=function(t,n,e){return p(t).npost(n,e)},h.prototype.nmapply=h.prototype.npost=function(t,n){var e=L(n||[]),r=a();return e.push(r.makeNodeResolver()),this.dispatch("post",[t,e]).fail(r.reject),r.promise},p.nsend=p.nmcall=p.ninvoke=function(t,n){var e=L(arguments,2),r=a();return e.push(r.makeNodeResolver()),p(t).dispatch("post",[n,e]).fail(r.reject),r.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(t){var n=L(arguments,1),e=a();return n.push(e.makeNodeResolver()),this.dispatch("post",[t,n]).fail(e.reject),e.promise},p.nodeify=$,h.prototype.nodeify=function(t){return t?void this.then(function(n){p.nextTick(function(){t(null,n)})},function(n){p.nextTick(function(){t(n)})}):this},p.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var fn=s();return p});
function Exists(n){return typeof n!="undefined"&&n!==null}var _f_=function(){},ice;window.console=window.console||{log:_f_,error:_f_,info:_f_,debug:_f_,warn:_f_,trace:_f_,dir:_f_,dirxml:_f_,group:_f_,groupEnd:_f_,time:_f_,timeEnd:_f_,assert:_f_,profile:_f_},function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){var i=this,t;(this.INTERACTION_API="interactionApi/",this.PLUGIN_ID="dbdfa0bd-ea02-46e3-bcc6-36b702c469c3",this.BROADCAST_KEY_IFRAME_SIZE=this.PLUGIN_ID+"_IFRAME_SIZE",this.CLASS_NORMAL="normalBgrd bgrd boxRound",this.CLASS_WARNING="warningBgrd bgrd boxRound",this.CLASS_ERROR="errorBgrd bgrd boxRound",this.APEX_NAMESPACE_DEFAULT="ingenius",this.APEX_CLASS_DEFAULT="CTIExtensions",this.ClientIP="",this.SfdcOrigin="",this.IFrameOrigin="",this.Nonce="",this.Debug=!1,this.LogLevel="",this.InConsole=!1,this.AdjustWidth=!0,this.AdjustHeight=!0,this.OpenCTI_ERROR="",this.CALL_CENTER_PROFILE="DEFAULT",this.IP_REGEX_PATTERN=".*",this.ICE_URL_A="",this.ICE_URL_B="",this.HEART_BEAT_TIMEOUT=10,this.BASE_RETRY_INTERVAL=10,this.MAX_RETRY_SHIFT=4,this.ICE_VERSION="2",this.ICEURLQueryString="",this.State=n.ResiliencyState.INITIALIZING,this.Await={inConsole:!0,getSessionInfo:!0,getCallCenterSettings:!0},this.CurrentURL="",this.ActionStart=0,this.RetryShift=0,this.Timeout=0,this.IFRAME_ELEMENT=null,this.MESSAGE_DIV=null,this.MESSAGE_TEXT=null,this.PROGRESS_DIV=null,this.SLIDER=null,this.reloadReason="",console.log("ICE.Resiliency.initialize ... "),this.BroadcastEventSystem=this.initializeBroadcastEventSystem(),t=this.parseUrlQueryString(location.search),t.clientIP&&t.sfdcIFrameOrigin&&t.nonce)&&(this.AdjustWidth=!0,t.adjustWidth&&(this.AdjustWidth=t.adjustWidth==="false"?!1:!0),this.AdjustHeight=!0,t.adjustHeight&&(this.AdjustHeight=t.adjustHeight==="false"?!1:!0),this.ClientIP=t.clientIP,this.SfdcOrigin=t.sfdcIFrameOrigin,this.ApexNamespace=t.apexNamespace,Exists(this.ApexNamespace)||(this.ApexNamespace=this.APEX_NAMESPACE_DEFAULT),this.ApexClass=t.apexClass,Exists(this.ApexClass)||(this.ApexClass=this.APEX_CLASS_DEFAULT),this.Nonce=t.nonce,this.ICEURLQueryString=this.buildQueryString({sfdcIFrameOrigin:this.getOriginFromUrl(window.location.href),sfdcIFrameOriginTop:this.SfdcOrigin,nonce:this.Nonce,apexNamespace:this.ApexNamespace}),window.addEventListener("message",function(n){i.processPostMessage(n)},!1),this.MESSAGE_DIV=document.getElementById("MESSAGE"),this.MESSAGE_TEXT=document.getElementById("MESSAGE_TEXT"),this.PROGRESS_DIV=document.getElementById("PROGRESS"),this.SLIDER=document.getElementById("SLIDER"),window.parent.postMessage(this.INTERACTION_API+this.buildQueryString({method:"isInConsole_0",nonce:this.Nonce}),this.SfdcOrigin),window.parent.postMessage(this.INTERACTION_API+this.buildQueryString({method:"runApex_0",apexClass:this.ApexNamespace+(this.ApexNamespace!==""?".":"")+this.ApexClass,methodName:"getSessionInfo",methodParams:null,nonce:this.Nonce}),this.SfdcOrigin),window.parent.postMessage(this.INTERACTION_API+this.buildQueryString({method:"getCallCenterSettings_0",nonce:this.Nonce}),this.SfdcOrigin))}return t.prototype.initializeBroadcastEventSystem=function(){var u=this,t=window.hasOwnProperty("ActiveXObject"),f=t&&navigator.userAgent.indexOf("MSIE 10")!==-1,e=t&&!window.ActiveXObject,o=f||e?1:0,i={log:function(){},keys:[this.BROADCAST_KEY_IFRAME_SIZE],instanceId:this.guid(),pluginID:this.PLUGIN_ID},r=o>=1?new n.IndexDBEventSystem(i):new n.LocalStorageEventSystem(i);return r.OnUpdate(function(n,t){u.processBroadcastEvent(n,t)}),r},t.prototype.processBroadcastEvent=function(n,t){if(n===this.BROADCAST_KEY_IFRAME_SIZE){var i=t.Height,r=t.Width;this.IFRAME_ELEMENT.style.height=i;this.IFRAME_ELEMENT.style.width=r}},t.prototype.setSoftphoneHeight=function(n){window.parent.postMessage(this.INTERACTION_API+this.buildQueryString({method:"setSoftphoneHeight_0",height:n.toString(),nonce:this.Nonce}),this.SfdcOrigin)},t.prototype.setSoftphoneWidth=function(n){window.parent.postMessage(this.INTERACTION_API+this.buildQueryString({method:"setSoftphoneWidth_0",width:n.toString(),nonce:this.Nonce}),this.SfdcOrigin)},t.prototype.parseUrlQueryString=function(n){var r={},u,t,i;if(typeof n!="string"||(n.charAt(0)==="?"&&(n=n.slice(1)),n.length===0))return r;for(u=n.split("&"),t=0;t<u.length;t++)i=u[t].split("="),r[i[0]]=!i[1]?"":decodeURIComponent(i[1]);return r},t.prototype.buildQueryString=function(n){var t="";for(var i in n)n.hasOwnProperty(i)&&(t+=i+"="+encodeURIComponent(n[i])+"&");return t.length>0?t.substr(0,t.length-1):t},t.prototype.buildUrl=function(n,t){var r=n.split("?"),u,i;return r.length==2?(u=r[1],i=u.split("#"),r[0]+"?"+i[0]+"&"+t+(i.length==2?"#"+i[1]:"")):n+"?"+t},t.prototype.getOriginFromUrl=function(n){var i=new RegExp("^((?:f|ht)tp(?:s)?://)([^/]+)","im"),t=n.match(i);return t?t[1].toString()+t[2].toString().toLowerCase():n},t.prototype.updateState=function(t){var o=this,f=this.ICE_URL_A===this.ICE_URL_B,i=(new Date).getTime(),e=this.State,u,h,r,s,c,l,a;this.Debug&&console.log("ICE.Resiliency.updateState:\n"+("   TIME:        "+i+"\n")+("   State:       "+this.State+"\n")+("   RetryShift:  "+this.RetryShift+"\n")+("   Event:       "+t+"\n")+("   CurrentURL:  "+this.CurrentURL+"\n")+("   Timeout in : "+Math.ceil((this.Timeout-i)/1e3)+" seconds"));switch(this.State){case n.ResiliencyState.INITIALIZING:this.RetryShift=0;this.IFrameOrigin=this.getOriginFromUrl(this.CurrentURL);u=document.createElement("iframe");u.id="ICE_IFRAME";u.name="scc_widget_SoftphoneIframe";u.frameBorder="0";u.allowtransparency="true";u.style.cssText="position: absolute; top: 0; left: 0; width: 200px; height: 1000px;";u.src=this.buildUrl(this.CurrentURL,this.ICEURLQueryString);document.body.appendChild(u);this.IFRAME_ELEMENT=document.getElementById("ICE_IFRAME");this.ActionStart=i;this.Timeout=i+this.HEART_BEAT_TIMEOUT*1e3;this.State=n.ResiliencyState.DETECTING_INITIAL;break;case n.ResiliencyState.DETECTING_INITIAL:t===n.ResiliencyEvent.HEARTBEAT?(this.ActionStart=i,this.Timeout=i+this.HEART_BEAT_TIMEOUT*1e3,localStorage.setItem("InGeniusCTIExtensions.LastGoodConnection",this.CurrentURL),this.State=n.ResiliencyState.CONNECTED):this.Timeout<i&&(this.IFrameOrigin=this.getOriginFromUrl(this.CurrentURL),this.IFRAME_ELEMENT.src=this.buildUrl(this.CurrentURL,this.ICEURLQueryString),this.ActionStart=i,this.Timeout=i+this.HEART_BEAT_TIMEOUT*1e3,this.State=n.ResiliencyState.DETECTING);break;case n.ResiliencyState.DETECTING:t===n.ResiliencyEvent.HEARTBEAT?(this.ActionStart=i,this.Timeout=i+this.HEART_BEAT_TIMEOUT*1e3,localStorage.setItem("InGeniusCTIExtensions.LastGoodConnection",this.CurrentURL),this.State=n.ResiliencyState.CONNECTED):this.Timeout<i&&(f||this.RetryShift>0?(this.ActionStart=i,this.Timeout=i+Math.floor(Math.random()*(this.BASE_RETRY_INTERVAL<<this.RetryShift)*1e3),this.State=n.ResiliencyState.BACKINGOFF):(this.CurrentURL=this.CurrentURL===this.ICE_URL_A?this.ICE_URL_B:this.ICE_URL_A,this.IFrameOrigin=this.getOriginFromUrl(this.CurrentURL),this.IFRAME_ELEMENT.src=this.buildUrl(this.CurrentURL,this.ICEURLQueryString),this.ActionStart=i,this.Timeout=i+this.HEART_BEAT_TIMEOUT*1e3,this.State=n.ResiliencyState.DETECTING_ALTERNATE));break;case n.ResiliencyState.DETECTING_ALTERNATE:t===n.ResiliencyEvent.HEARTBEAT?(this.ActionStart=i,this.Timeout=i+this.HEART_BEAT_TIMEOUT*1e3,localStorage.setItem("InGeniusCTIExtensions.LastGoodConnection",this.CurrentURL),this.State=n.ResiliencyState.CONNECTED):this.Timeout<i&&(this.ActionStart=i,this.Timeout=i+Math.floor(Math.random()*(this.BASE_RETRY_INTERVAL<<this.RetryShift)*1e3),this.State=n.ResiliencyState.BACKINGOFF);break;case n.ResiliencyState.BACKINGOFF:this.Timeout<i&&(this.RetryShift<this.MAX_RETRY_SHIFT&&this.RetryShift++,this.CurrentURL=this.CurrentURL===this.ICE_URL_A?this.ICE_URL_B:this.ICE_URL_A,this.IFrameOrigin=this.getOriginFromUrl(this.CurrentURL),this.IFRAME_ELEMENT.src=this.buildUrl(this.CurrentURL,this.ICEURLQueryString),this.ActionStart=i,this.Timeout=i+this.HEART_BEAT_TIMEOUT*1e3,this.State=n.ResiliencyState.DETECTING);break;case n.ResiliencyState.CONNECTED:t===n.ResiliencyEvent.HEARTBEAT?(this.ActionStart=i,this.Timeout=i+this.HEART_BEAT_TIMEOUT*1e3):t===n.ResiliencyEvent.UNLOADING?this.State=n.ResiliencyState.UNLOADING:(this.Timeout<i||t===n.ResiliencyEvent.RELOAD)&&(t===n.ResiliencyEvent.TIMER&&console.error("!! ICE heartbeat lost !!"),h=!f&&this.CurrentURL===this.ICE_URL_A&&(this.reloadReason==="PRIORITY_STANDBY"||this.reloadReason==="SERVER_SHUTDOWN"),this.RetryShift=0,this.CurrentURL=h?this.ICE_URL_B:this.ICE_URL_A,this.IFrameOrigin=this.getOriginFromUrl(this.CurrentURL),this.IFRAME_ELEMENT.src=this.buildUrl(this.CurrentURL,this.ICEURLQueryString),this.ActionStart=i,this.Timeout=i+this.HEART_BEAT_TIMEOUT*1e3,this.State=h?n.ResiliencyState.DETECTING_ALTERNATE:n.ResiliencyState.DETECTING,this.reloadReason="");break;case n.ResiliencyState.UNLOADING:t===n.ResiliencyEvent.HEARTBEAT&&(this.State=n.ResiliencyState.CONNECTED)}r=Math.ceil((this.Timeout-this.ActionStart)/1e3);s=Math.ceil((this.Timeout-i)/1e3);switch(this.State){case n.ResiliencyState.DETECTING_INITIAL:this.uiSetDisplay("none","none");break;case n.ResiliencyState.DETECTING:case n.ResiliencyState.DETECTING_ALTERNATE:this.PROGRESS_DIV.title="Waited "+(r-s)+" of "+r+" second"+(r===1?"":"s");this.State!=e&&(c=f?"Trying to connect...":"Trying server {0}...",this.uiSetProgressSlider(0,0),setTimeout(function(){o.uiSetProgressSlider(100,r)},0),this.MESSAGE_DIV.className=this.CLASS_WARNING,this.MESSAGE_TEXT.innerHTML=c.replace("{0}",this.CurrentURL===this.ICE_URL_A?"A":"B"),this.uiSetDisplay("block","none"),this.setSoftphoneHeight(100),this.setSoftphoneWidth(200));break;case n.ResiliencyState.BACKINGOFF:this.PROGRESS_DIV.title="Waited "+(r-s)+" of "+r+" second"+(r===1?"":"s");this.State!=e&&(l=f?"Failed to connect to server.<br/>Waiting to retry...":"Failed to connect to server {0}.<br/>Waiting to retry...",this.uiSetProgressSlider(0,0),setTimeout(function(){o.uiSetProgressSlider(100,r)},0),this.MESSAGE_DIV.className=this.CLASS_ERROR,this.MESSAGE_TEXT.innerHTML=l.replace("{0}",this.CurrentURL===this.ICE_URL_A?"A":"B").replace("{1}",this.CurrentURL!=this.ICE_URL_A?"A":"B"),this.uiSetDisplay("block","none"),this.setSoftphoneHeight(100),this.setSoftphoneWidth(200));break;case n.ResiliencyState.CONNECTED:a=f?"Connected to the server<br/>Next heartbeat in: {1} seconds":"Connected to server {0}<br/>Next heartbeat in: {1} seconds";this.MESSAGE_TEXT.innerHTML=a.replace("{0}",this.CurrentURL===this.ICE_URL_A?"A":"B").replace("{1}",s.toString());this.State!=e&&this.uiSetDisplay("none","block");break;case n.ResiliencyState.UNLOADING:this.Debug&&this.State!=e&&(this.uiSetProgressSlider(0,0),setTimeout(function(){o.uiSetProgressSlider(100,2)},0),this.MESSAGE_DIV.className=this.CLASS_WARNING,this.MESSAGE_TEXT.innerHTML="Unloading ...",this.uiSetDisplay("block","none"));break;case n.ResiliencyState.ERROR:this.State!=e&&(this.MESSAGE_DIV.className=this.CLASS_ERROR,this.MESSAGE_TEXT.innerHTML="Error: Open CTI API not responding",this.MESSAGE_TEXT.title=this.OpenCTI_ERROR,this.uiSetDisplay("block","none"),this.PROGRESS_DIV.style.display="none",this.setSoftphoneHeight(100),this.setSoftphoneWidth(200))}t===n.ResiliencyEvent.TIMER&&this.State!==n.ResiliencyState.UNLOADING&&setTimeout(function(){o.updateState(n.ResiliencyEvent.TIMER)},1e3)},t.prototype.uiSetProgressSlider=function(n,t){for(var i in{"-webkit-transition-duration":0,"-moz-transition-duration":0,"-ms-transition-duration":0,"-o-transition-duration":0,"transition-duration":0})this.SLIDER.style[i]=t+"s";this.SLIDER.filters&&(this.SLIDER.style.filter="progid:DXImageTransform.Microsoft.Stretch(bands='1',stretchStyle='hide',duration="+t+")",this.SLIDER.style.width="0",this.SLIDER.filters[0].Apply());this.SLIDER.style.width=n+"%";this.SLIDER.filters&&this.SLIDER.filters[0].Play()},t.prototype.uiSetDisplay=function(n,t){this.PROGRESS_DIV.style.display=n;this.MESSAGE_DIV.style.display=n;this.IFRAME_ELEMENT.style.display=t},t.prototype.processPostMessage=function(t){var r,u,i,f;t||(t=window.event);this.Debug&&console.log("ICE.Resiliency.processPostMessage:\n   e.data: "+t.data+"\n   e.origin: "+t.origin+"; ");t.origin.toLowerCase()===this.SfdcOrigin.toLowerCase()?this.State===n.ResiliencyState.CONNECTED?this.IFRAME_ELEMENT.contentWindow.postMessage(t.data,this.IFrameOrigin):this.State===n.ResiliencyState.INITIALIZING&&this.handleInitializationResponse(t):t.origin.toLowerCase()===this.IFrameOrigin.toLowerCase()&&(r=t.data,u=this.parseUrlQueryString(r),t.data.indexOf(this.INTERACTION_API)===0?(this.updateIFrameSize(u),window.parent.postMessage(r,this.SfdcOrigin)):u.ICE?(i=u.ICE,i.indexOf("Unloading")===0?this.updateState(n.ResiliencyEvent.UNLOADING):i.indexOf("Reload")===0?(f=i.split("-"),this.reloadReason=f[1],this.updateState(n.ResiliencyEvent.RELOAD)):i.indexOf("Heartbeat")===0&&this.updateState(n.ResiliencyEvent.HEARTBEAT)):console.error(r))},t.prototype.updateIFrameSize=function(n){var i=this.INTERACTION_API+"method",t;if(n&&n[i]&&(n[i].indexOf("setSoftphoneHeight")===0&&n.height||n[i].indexOf("setSoftphoneWidth")===0&&n.width)){var r=!1,u=this.IFRAME_ELEMENT.style.height,f=this.IFRAME_ELEMENT.style.width,e=parseInt(n.height,10);isFinite(e)&&u!==e+"px"&&(u=this.IFRAME_ELEMENT.style.height=e.toString()+"px",r=!0);t=parseInt(n.width,10);isFinite(t)&&f!==t+"px"&&(f=this.IFRAME_ELEMENT.style.width=t.toString()+"px",r=!0);r&&this.BroadcastEventSystem.PostItem(this.BROADCAST_KEY_IFRAME_SIZE,{Height:u.toString(),Width:f.toString()})}},t.prototype.handleInitializationResponse=function(t){var r,i,u,f,e,o,h,s;if(t.data.indexOf(this.INTERACTION_API)===0){if(r=this.parseUrlQueryString(t.data.replace(this.INTERACTION_API,"")),r.method=="isInConsole_0")this.Await.inConsole=!1,r.result?(this.InConsole=r.result==="true",console.log("ICE.Resiliency.CTIExtensions.isInConsole: "+this.InConsole)):(console.log("ICE.Resiliency.CTIExtensions.isInConsole ERROR:\n    "+r.error),this.State!==n.ResiliencyState.ERROR&&(this.OpenCTI_ERROR="isInConsole: "+r.error),this.State=n.ResiliencyState.ERROR,this.updateState(n.ResiliencyEvent.TIMER));else if(r.method=="runApex_0")this.Await.getSessionInfo=!1,r.result?(i=JSON.parse(r.result),console.log("ICE.Resiliency.CTIExtensions.SessionInfo:\n"+("   VERSION:       "+i.Version+"\n")+("   ORG ID:        "+i.OrgID+"\n")+("   ORG NAME:      "+i.OrgName+"\n")+("   USER ID:       "+i.UserID+"\n")+("   USER NAME:     "+i.UserName+"\n")+("   USER LOCALE:   "+i.UserLocale+"\n")+("   USER LANGUAGE: "+i.UserLanguage+"\n")+("   SESSION ID:    "+i.SessionID))):(console.log("ICE.Resiliency.CTIExtensions.SessionInfo ERROR:\n    "+r.error),this.State!==n.ResiliencyState.ERROR&&(this.OpenCTI_ERROR="SessionInfo: "+r.error),this.State=n.ResiliencyState.ERROR,this.updateState(n.ResiliencyEvent.TIMER));else if(r.method=="getCallCenterSettings_0")if(this.Await.getCallCenterSettings=!1,r.result){i=JSON.parse(r.result);i["/profileConfiguration/profileName"]&&(u=i["/profileConfiguration/profileName"].split("|"),this.CALL_CENTER_PROFILE=u[0],u.length==2&&(this.Debug=!0,this.LogLevel=u[1]));i["/availabilityConfiguration/ipRegex"]&&i["/availabilityConfiguration/ipRegex"].replace(/^\s+/,"").replace(/\s+$/,"").length!=0&&(this.IP_REGEX_PATTERN=i["/availabilityConfiguration/ipRegex"]);i["/resiliencyConfiguration/iceVersion"]&&(this.ICE_VERSION=i["/resiliencyConfiguration/iceVersion"]);i["/resiliencyConfiguration/resiliencyIceUrlA"]&&(this.ICE_URL_A=i["/resiliencyConfiguration/resiliencyIceUrlA"],this.ICE_URL_B=i["/resiliencyConfiguration/resiliencyIceUrlA"]);i["/resiliencyConfiguration/resiliencyIceUrlB"]&&(this.ICE_URL_B=i["/resiliencyConfiguration/resiliencyIceUrlB"]);i["/resiliencyConfiguration/resiliencyHeartbeatTimeout"]&&(f=parseInt(i["/resiliencyConfiguration/resiliencyHeartbeatTimeout"]),isFinite(f)&&(this.HEART_BEAT_TIMEOUT=f));i["/resiliencyConfiguration/resiliencyBaseRetryInterval"]&&(e=parseInt(i["/resiliencyConfiguration/resiliencyBaseRetryInterval"]),isFinite(e)&&(this.BASE_RETRY_INTERVAL=e));i["/resiliencyConfiguration/resiliencyMaxRetryShift"]&&(o=parseInt(i["/resiliencyConfiguration/resiliencyMaxRetryShift"]),isFinite(o)&&(this.MAX_RETRY_SHIFT=o));console.log("ICE.Resiliency.Settings:\n"+("   ICE_VERSION:          "+this.ICE_VERSION+"\n")+("   CALL_CENTER_PROFILE:  "+this.CALL_CENTER_PROFILE+"\n")+("   IP_REGEX_PATTERN:     "+this.IP_REGEX_PATTERN+"\n")+("   ICE_URL_A :           "+this.ICE_URL_A+"\n")+("   ICE_URL_B :           "+this.ICE_URL_B+"\n")+("   HEART_BEAT_TIMEOUT :  "+this.HEART_BEAT_TIMEOUT+"\n")+("   BASE_RETRY_INTERVAL : "+this.BASE_RETRY_INTERVAL+"\n")+("   MAX_RETRY_SHIFT :     "+this.MAX_RETRY_SHIFT+"\n")+("   DEBUG :               "+this.Debug+"\n")+("   LOG_LEVEL :           "+this.LogLevel));this.CurrentURL=this.ICE_URL_A;localStorage.getItem("InGeniusCTIExtensions.LastGoodConnection")&&localStorage.getItem("InGeniusCTIExtensions.LastGoodConnection")==this.ICE_URL_B&&(this.CurrentURL=this.ICE_URL_B);console.log("ICE.Resiliency.Settings:\n   CurrentURL : "+this.CurrentURL);try{if(h=new RegExp(this.IP_REGEX_PATTERN,"i"),!h.test(this.ClientIP)){this.MESSAGE_TEXT.innerHTML="CTI not available at this location";this.MESSAGE_DIV.className=this.CLASS_NORMAL;this.PROGRESS_DIV.style.display="none";this.MESSAGE_DIV.style.display="block";this.setSoftphoneHeight(50);this.setSoftphoneWidth(200);return}}catch(c){console.warn("ICE.IP_REGEX_PATTERN is invalid. Trying to load CTI integration.")}s=Math.floor(this.HEART_BEAT_TIMEOUT*.7);console.log("ICE.Resiliency.HeartBeatInterval set to 70% of HEART_BEAT_TIMEOUT ("+s+")");this.ICEURLQueryString=this.buildQueryString({resiliency:s,inConsole:this.InConsole,config:this.CALL_CENTER_PROFILE,sfdcIFrameOrigin:this.getOriginFromUrl(window.location.href),sfdcIFrameOriginTop:this.SfdcOrigin,nonce:this.Nonce,debug:this.Debug.toString(),loglevel:this.LogLevel,apexNamespace:this.ApexNamespace,apexClass:this.ApexClass})}else console.log("ICE.Resiliency.getCallCenterSettings ERROR:\n    "+r.error),this.State!==n.ResiliencyState.ERROR&&(this.OpenCTI_ERROR="getCallCenterSettings: "+r.error),this.State=n.ResiliencyState.ERROR,this.updateState(n.ResiliencyEvent.TIMER);this.Await.inConsole||this.Await.getSessionInfo||this.Await.getCallCenterSettings||this.updateState(n.ResiliencyEvent.TIMER)}},t.prototype.guid=function(){var n=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},t}();t.InGeniusCTIExtensions=i})(i=t.apex||(t.apex={}))})(t=n.salesforce||(n.salesforce={}))}(ice||(ice={}));window.onload=function(){window.InGeniusCTIExtensions=new ice.salesforce.apex.InGeniusCTIExtensions},function(n){var t,i,r,u,f,e,o,s,h,c;(function(n){n[n.INITIALIZING=0]="INITIALIZING";n[n.DETECTING_INITIAL=1]="DETECTING_INITIAL";n[n.DETECTING=2]="DETECTING";n[n.DETECTING_ALTERNATE=3]="DETECTING_ALTERNATE";n[n.BACKINGOFF=4]="BACKINGOFF";n[n.CONNECTED=5]="CONNECTED";n[n.UNLOADING=6]="UNLOADING";n[n.ERROR=7]="ERROR"})(n.ResiliencyState||(n.ResiliencyState={}));t=n.ResiliencyState,function(n){n[n.HEARTBEAT=0]="HEARTBEAT";n[n.UNLOADING=1]="UNLOADING";n[n.TIMER=2]="TIMER";n[n.RELOAD=3]="RELOAD"}(n.ResiliencyEvent||(n.ResiliencyEvent={}));i=n.ResiliencyEvent,function(n){n[n.NA=0]="NA";n[n.Active=1]="Active";n[n.Standby=2]="Standby";n[n.StandbyPending=3]="StandbyPending"}(n.ServerPriority||(n.ServerPriority={}));r=n.ServerPriority,function(n){n[n.HEARTBEAT_LOST=0]="HEARTBEAT_LOST";n[n.SERVER_SHUTDOWN=1]="SERVER_SHUTDOWN";n[n.PRIORITY_STANDBY=2]="PRIORITY_STANDBY"}(n.ServerReloadReason||(n.ServerReloadReason={}));u=n.ServerReloadReason,function(n){n[n.small=0]="small";n[n.medium=1]="medium";n[n.large=2]="large"}(n.SupportedFontSizes||(n.SupportedFontSizes={}));f=n.SupportedFontSizes,function(n){n[n.Normal=0]="Normal";n[n.Minimized=1]="Minimized";n[n.Hidden=2]="Hidden"}(n.SupportedLineSettings||(n.SupportedLineSettings={}));e=n.SupportedLineSettings,function(n){n[n.Ringing=0]="Ringing";n[n.Answered=1]="Answered";n[n.Never=2]="Never"}(n.SupportedAutoPopSettings||(n.SupportedAutoPopSettings={}));o=n.SupportedAutoPopSettings,function(n){n[n.None=0]="None";n[n.DoneButtonFailed=1]="DoneButtonFailed";n[n.EditButtonFailed=2]="EditButtonFailed"}(n.SaveFailedType||(n.SaveFailedType={}));s=n.SaveFailedType,function(n){n[n.Critical=0]="Critical";n[n.Error=1]="Error";n[n.Warning=2]="Warning";n[n.Info=3]="Info";n[n.Verbose=4]="Verbose";n[n.Debug=5]="Debug";n[n.Special=6]="Special"}(n.LogLevel||(n.LogLevel={}));h=n.LogLevel,function(n){n[n.ShowTop3CallRows=0]="ShowTop3CallRows";n[n.ShowActiveCallRows=1]="ShowActiveCallRows";n[n.ShowAllCallRows=2]="ShowAllCallRows"}(n.TableExpansion||(n.TableExpansion={}));c=n.TableExpansion}(ice||(ice={})),function(n){var t;(function(n){var r=function(){function n(){}return Object.defineProperty(n,"Ringing",{get:function(){return"Ringing"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"WaitingForDigits",{get:function(){return"WaitingForDigits"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Trying",{get:function(){return"Trying"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Connected",{get:function(){return"Connected"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Holding",{get:function(){return"Holding"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"HeldRemotely",{get:function(){return"HeldRemotely"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"WrapUp",{get:function(){return"WrapUp"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Invalid",{get:function(){return"Invalid"},enumerable:!0,configurable:!0}),n}(),t,i;n.CallState=r;t=function(){function n(){}return Object.defineProperty(n,"None",{get:function(){return"None"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LogIn",{get:function(){return"LogIn"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"NotReady",{get:function(){return"NotReady"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Ready",{get:function(){return"Ready"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Busy",{get:function(){return"Busy"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Talking",{get:function(){return"Talking"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Hold",{get:function(){return"Hold"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"WrapUp",{get:function(){return"WrapUp"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Reserved",{get:function(){return"Reserved"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LogOut",{get:function(){return"LogOut"},enumerable:!0,configurable:!0}),n}();n.AgentAction=t;i=function(){function n(){}return Object.defineProperty(n,"NotReady",{get:function(){return"NotReady"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Ready",{get:function(){return"Ready"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Busy",{get:function(){return"Busy"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Talking",{get:function(){return"Talking"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Hold",{get:function(){return"Hold"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"WrapUp",{get:function(){return"WrapUp"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Reserved",{get:function(){return"Reserved"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LoggedOut",{get:function(){return"LoggedOut"},enumerable:!0,configurable:!0}),n}();n.AgentState=i})(t=n.telephony||(n.telephony={}))}(ice||(ice={})),function(n){var i="InGeniusTimestampIndex",t="Events",r=function(){function n(n,r){var u=this,f,e;r===void 0&&(r=5e3);this.config=n;this.cleanUpPollerInterval=r;this.indexedDB=null;this.lastUpdateTime=0;this.eventHandler=function(){};this.cache={};this.Name="Index DB";this.initialized=Q.defer();try{f=window.indexedDB.open(this.config.pluginID+"_ICE_EVENTS",3);f.onupgradeneeded=function(n){u.config.log("indexedDB.onupgradeneeded.");var r=n.target.result,f=null;f=r.objectStoreNames.contains(t)?n.target.transaction.objectStore(t):r.createObjectStore(t,{autoIncrement:!0,keyPath:"AutoIncrementDBKey"});f.createIndex(i,"Timestamp",{unique:!1})};f.onsuccess=function(){var n=f.result.transaction([t],"readonly"),i=n.objectStore(t);u.indexedDB=f.result;u.config.log("indexedDB.indexedDBPoller: Starting up...");u.getNewWrappedEvents(u.lastUpdateTime,i).done(function(n){u.updateCacheWithWrappedEvents(n);u.initialized.resolve();setTimeout(function(){return u.fetchPoller()},100);setTimeout(function(){return u.cleanUpPoller()},u.cleanUpPollerInterval)})};f.onerror=function(n){var t=n.message;u.config.log("indexedDB.open Error: "+t);u.initialized.reject(t)}}catch(o){e=o.message;this.config.log("indexedDB.intialize Error: "+e);this.initialized.reject(e)}}return n.prototype.updateLastCheckedTime=function(n){n.length>0&&(this.lastUpdateTime=n[n.length-1].Timestamp)},n.prototype.getDatabaseStore=function(n){var i=n.transaction(t,"readwrite");return i.objectStore(t)},n.prototype.getNewEventsAndBroadcast=function(n,t,i){var r=this,u=Q.defer();return this.getNewWrappedEvents(this.lastUpdateTime,i).done(function(n){r.updateCacheWithWrappedEvents(n);r.broadcastEvents(r.filterWrappedEvent(n,t));u.resolve(n)}),u.promise},n.prototype.broadcastEvents=function(n){for(var t=0;t<n.length;++t){var i=n[t],r=i.Key,u=i.Data;this.eventHandler(r,u)}},n.prototype.getWrappedEventsWithTimestampKeyRange=function(n,t){var r=Q.defer(),u=[],f=t.index(i);return f.openCursor(n).onsuccess=function(n){var t=n.target.result;t?(u.push(t.value),t.continue()):r.resolve(u)},r.promise},n.prototype.getNewWrappedEvents=function(n,t){var r=this,i=Q.defer(),u=IDBKeyRange.lowerBound(n,!0);return this.getWrappedEventsWithTimestampKeyRange(u,t).done(function(n){r.updateLastCheckedTime(n);i.resolve(n)}),i.promise},n.prototype.updateCacheWithWrappedEvents=function(n){var t=this;n.forEach(function(n){t.updateCacheEntry(n.Key,n.Data)})},n.prototype.filterWrappedEvent=function(n,t){var i=this;return n.filter(function(n){return n.SourceId!==t&&i.config.keys.indexOf(n.Key)!==-1})},n.prototype.wrapEvent=function(n,t){var i=(new Date).getTime(),r=n,u=this.config.instanceId,f=t;return{Timestamp:i,Key:r,SourceId:u,Data:f}},n.prototype.updateCacheEntry=function(n,t){var i=!1;return this.config.keys.indexOf(n)!==-1&&(this.cache[n]=t,i=!0),i},n.prototype.fetchPoller=function(){var n=this,t=this.getDatabaseStore(this.indexedDB);this.getNewEventsAndBroadcast(this.lastUpdateTime,this.config.instanceId,t).done(function(){setTimeout(function(){return n.fetchPoller()},100)})},n.prototype.cleanUpPoller=function(){var n=this,r=this.getDatabaseStore(this.indexedDB),u=IDBKeyRange.upperBound((new Date).getTime()-this.cleanUpPollerInterval),f=r.index(i),t={};f.openCursor(u,IDBCursor.PREV).onsuccess=function(i){var r=i.target.result,u;r?(u=r.value,t[u.Key]?t[u.Key]=1:r.delete(),r.continue()):setTimeout(function(){return n.cleanUpPoller()},n.cleanUpPollerInterval)}},n.prototype.GetItem=function(n){var t=null;return this.config.keys.indexOf(n)!==-1&&(t=this.cache[n]),t},n.prototype.PostItem=function(n,t){var i=this,r=JSON.parse(JSON.stringify(t));this.initialized.promise.done(function(){if(i.updateCacheEntry(n,r)){var t=i.wrapEvent(n,r),u=i.getDatabaseStore(i.indexedDB);u.put(t)}})},n.prototype.OnUpdate=function(n){this.eventHandler=typeof n=="function"?n:function(){}},n}();n.IndexDBEventSystem=r}(ice||(ice={})),function(n){var t=function(){function n(n){this.config=n;this.onUpdateHandler=function(){};this.Name="Local Storage"}return n.prototype.GetItem=function(n){return JSON.parse(window.localStorage.getItem(n))},n.prototype.PostItem=function(n,t){window.localStorage.setItem(n,JSON.stringify(t))},n.prototype.OnUpdate=function(n){var t=this;typeof n=="function"?(this.onUpdateHandler=n,window.addEventListener("storage",function(n){return t.onLocalStorageEvent(n)},!1)):(this.onUpdateHandler=function(){},window.removeEventListener("storage",this.onLocalStorageEvent))},n.prototype.onLocalStorageEvent=function(n){var t=n.key;if(this.config.keys.indexOf(t)!==-1)this.onUpdateHandler(t,JSON.parse(n.newValue))},n}();n.LocalStorageEventSystem=t}(ice||(ice={}));    </script>

    <style type="text/css">
        /* Source code in Plugins\ClientHandlers\Salesforce\SOURCE\SFDCSetupResources\CTIIntegration.scss */
        /**/
div,span,iframe,body{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;}body{overflow:hidden;font-family:Arial,Helvetica,sans-serif;font-size:75%;}.boxRound{-webkit-border-radius:7px;border-radius:7px;-webkit-background-clip:padding-box;-moz-background-clip:padding;background-clip:padding-box;}.bgrd{position:absolute;top:0;left:0;padding:10px 10px 10px 10px;height:100%;width:100%;z-index:0;width:200px;}.normalBgrd,.warningBgrd,.errorBgrd{background-color:#cfeef8;color:#214b76;}.errorBgrd{padding:10px;text-indent:0;}#MESSAGE{position:absolute;z-index:1;text-align:center;}#MESSAGE_TEXT{display:block;padding-top:7px;}.meter{width:100px;height:8px;position:relative;margin:15px 0 0 40px;background:#add2f8;border:solid 1px #78b5f2;-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px;padding:0;-webkit-box-shadow:inset 0 -1px 1px rgba(255,255,255,.3);-moz-box-shadow:inset 0 -1px 1px rgba(255,255,255,.3);box-shadow:inset 0 -1px 1px rgba(255,255,255,.3);}.meter>span{display:block;height:100%;width:0;position:relative;overflow:hidden;-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px;-webkit-border-top-right-radius:3px;-moz-border-radius-topright:3px;border-top-right-radius:3px;-webkit-border-bottom-right-radius:3px;-moz-border-radius-bottomright:3px;border-bottom-right-radius:3px;background-color:#0482ff;background-image:-webkit-gradient(linear,left top,left bottom,from(#359aff),to(#0482ff));background-image:-webkit-linear-gradient(top,#359aff,#0482ff);background-image:-moz-linear-gradient(top,#359aff,#0482ff);background-image:-ms-linear-gradient(top,#359aff,#0482ff);background-image:-o-linear-gradient(top,#359aff,#0482ff);background-image:linear-gradient(to bottom,#359aff,#0482ff);-webkit-box-shadow:inset 0 2px 9px rgba(255,255,255,.3),inset 0 -2px 6px rgba(0,0,0,.4);-moz-box-shadow:inset 0 2px 9px rgba(255,255,255,.3),inset 0 -2px 6px rgba(0,0,0,.4);box-shadow:inset 0 2px 9px rgba(255,255,255,.3),inset 0 -2px 6px rgba(0,0,0,.4);-webkit-transition:.5s ease-out;-moz-transition:.5s ease-out;-ms-transition:.5s ease-out;-o-transition:.5s ease-out;transition:.5s ease-out;filter:progid:DXImageTransform.Microsoft.Stretch(bands='1',stretchStyle='hide',duration=1);}.meter>span:after,.animate>span>span{content:"";position:absolute;top:0;left:0;bottom:0;right:0;overflow:hidden;background-image:-webkit-gradient(linear,0 0,100% 100%,color-stop(.25,rgba(255,255,255,.3)),color-stop(.25,transparent),color-stop(.5,transparent),color-stop(.5,rgba(255,255,255,.3)),color-stop(.75,rgba(255,255,255,.3)),color-stop(.75,transparent),to(transparent));background-image:-moz-linear-gradient(-45deg,rgba(255,255,255,.3) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.3) 50%,rgba(255,255,255,.3) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(-45deg,rgba(255,255,255,.3) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.3) 50%,rgba(255,255,255,.3) 75%,transparent 75%,transparent);background-size:30px 30px;-webkit-animation:moveFrames 2s linear infinite;-moz-animation:moveFrames 2s linear infinite;-ms-animation:moveFrames 2s linear infinite;-o-animation:moveFrames 2s linear infinite;animation:moveFrames 2s linear infinite;-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px;-webkit-border-top-right-radius:3px;-moz-border-radius-topright:3px;border-top-right-radius:3px;-webkit-border-bottom-right-radius:3px;-moz-border-radius-bottomright:3px;border-bottom-right-radius:3px;}.animate>span:after{display:none;}@-webkit-keyframes moveFrames{0%{background-position:0 0;}100%{background-position:30px 30px;}}@-moz-keyframes moveFrames{0%{background-position:0 0;}100%{background-position:30px 30px;}}@-ms-keyframes moveFrames{0%{background-position:0 0;}100%{background-position:30px 30px;}}@-o-keyframes moveFrames{0%{background-position:0 0;}100%{background-position:30px 30px;}}@keyframes moveFrames{0%{background-position:0 0;}100%{background-position:30px 30px;}}    </style>
</head>
<body>
    <div id="MESSAGE" class="bgrd normalBgrd boxRound" style="display: none">
        <div id="PROGRESS" class="meter animate"><span id="SLIDER"><span></span></span></div>
        <span id="MESSAGE_TEXT">Fetching call center settings...</span>
    </div>
</body>
</html>
